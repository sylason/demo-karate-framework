/*************************************************************************
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2015 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by all applicable intellectual property laws,
* including trade secret and or copyright laws.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
let isCursorOnPopup=!1;const isGoogleSearchLink=checkGoogleSearchLink();let hoverTimeout,currentPopupTimeouts=new Map,showAssistantMarker=!0;function showPopup(e,t){const o=`__assistantPopup__${t}`;if(document.getElementById(o))hoverTimeout=setTimeout((()=>showPopup(e,t)),300);else{let n=e.getBoundingClientRect(),r=document.createElement("iframe");r.id=o,r.style.cssText=`\n            border: 0;\n            z-index: 127;\n            position: absolute;\n            margin: auto;\n            background: transparent;\n            color-scheme: auto;\n            left: ${n.right+(scrollX||0)}px;\n            top: ${n.top+(scrollY||0)-8}px;\n            width: 400px;\n            min-height: unset;\n            overflow: hidden;\n        `,r.src=chrome.runtime.getURL("browser/js/assistantPopup.html?pdfMarkerLink="+t),document.body.appendChild(r),r.addEventListener("mouseenter",(()=>{isCursorOnPopup=!0})),r.addEventListener("mouseleave",(()=>{isCursorOnPopup=!1,hidePopup(t)}))}}function hidePopup(e){const t=`__assistantPopup__${e}`,o=document.getElementById(t);if(o){currentPopupTimeouts.has(e)&&clearTimeout(currentPopupTimeouts.get(e)),o.contentWindow.postMessage({action:"exit"},`chrome-extension://${chrome.runtime.id}`);const t=setTimeout((()=>{o.remove(),currentPopupTimeouts.delete(e)}),400);currentPopupTimeouts.set(e,t)}}function checkGoogleSearchLink(){const e=window.location.href;return/https:\/\/www\.google\.(com|co.[a-z]{2})\/search\?/.test(e)&&e.includes("q=")}function addPdfIconToLinks(){document.querySelectorAll("a[href]").forEach((e=>{const t=e.getAttribute("href");if(t.match(/\.pdf(?:\?[^#]*)?(?:#.*)?$/i)&&e.textContent.trim().length>0){const o=isGoogleSearchLink?e.getElementsByTagName("h3")[0]:e;e.addEventListener("mouseenter",(()=>{showAssistantMarker&&(hoverTimeout=setTimeout((()=>{chrome.runtime.sendMessage({main_op:"analytics",analytics:[["DCBrowserExt:PdfLink:Hovered"]]}),showPopup(o,t)}),200),o.style.backgroundColor="rgb(88, 76, 204, 0.1)",o.style.borderRadius="8px")})),e.addEventListener("mouseleave",(()=>{o.style.backgroundColor="",o.style.borderRadius="",setTimeout((()=>!isCursorOnPopup&&hidePopup(t)),400),clearTimeout(hoverTimeout)}))}}))}!async function(){const e=Array.from(document.querySelectorAll("a[href]")).some((e=>e.getAttribute("href").match(/\.pdf(?:\?[^#]*)?(?:#.*)?$/i)&&e.textContent.trim().length>0));chrome.runtime.sendMessage({main_op:"resolve-has-pdf-promise",hasPDFLink:e});const{appLocale:t,installSource:o,pdfViewer:n,egaf:r,aiMarkers:s,genAIEligible:i}=await chrome.storage.local.get(["appLocale","installSource","pdfViewer","egaf","aiMarkers","genAIEligible"]);if("en"!==t?.split("-")[0]||"admin"===o||"false"===n||"false"===r||"false"===s||"true"!==i)return;const a="true"===(await chrome.storage.managed.get("DisableGenAI"))?.DisableGenAI,c=await chrome.runtime.sendMessage({main_op:"getFloodgateFlag",flag:"dc-cv-genai-markers-internal",cachePurge:"NO_CALL"}),u=await chrome.runtime.sendMessage({main_op:"getFloodgateMeta",flag:"dc-cv-genai-markers-allowlist"});let l;try{l=JSON.parse(u||"[]").some((e=>window.location.href.match(e)))}catch(e){l=!1}!a&&c&&l&&addPdfIconToLinks()}(),chrome.runtime.onMessage.addListener(((e,t,o)=>{"hideAIMarkerPopup"===e.content_op&&(hidePopup(e.href),showAssistantMarker=!1)}));