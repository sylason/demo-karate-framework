/*************************************************************************
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2015 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by all applicable intellectual property laws,
* including trade secret and or copyright laws.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
import{analytics as e,events as t}from"../../common/analytics.js";import{dcLocalStorage as n}from"../../common/local-storage.js";import{util as s}from"./content-util.js";import{privateApi as a}from"./content-privateApi.js";import{LOCALES as i,LOCAL_FILE_PERMISSION_URL as r,OptionPageActions as o}from"../../common/constant.js";import{getGenAIServiceVariant as c}from"../../common/util.js";await n.init(),$((function(){const l=10,p={AnalyticsOptinTitle:"analyticsOptinTitle",AnalyticsOptinDescription:"web2pdfOptOut",AnalyticsOptinDisabledDescription:"web2pdfOptOutDisabled",AnalyticsLearnMoreLink:"LearnMoreURL",AnalyticsLearnMoreTitle:"web2pdfPrivacy",ShowPDFToolsTitle:"web2pdfShowPDFTools",ShowPDFToolsDescription:"web2pdfFrictionlessToggleDescription",ViewerOwnershipTitle:"pdfOwnershipExploreOptionsTitle",ViewerOwnershipDescription:"pdfOwnershipExploreOptionsDescription",ViewConvertedPDFInAcrobatTitle:"web2pdfOpenConvertedPDFTitle",ViewConvertedPDFInAcrobatDescription:"web2pdfOpenConvertedPDFDescription",PersistentOpenInAcrobatTitle:"web2pdfShowPersistentOpen",PersistentOpenInAcrobatDescription:"web2pdfShowPersistentOpenDescription",WebpageConversionTitle:"webpagePDFConversion",WebpageConversionDescription:"webpagePDFConversionDescription",EnableGenAIFeaturesTitle:"enableGenAIFeaturesTitle",EnableGenAIFeaturesDescription:"enableGenAIFeaturesDescription",PromptSuccessMessage:"optionsSuccessPrompt",PromptSuccessReloadRequiredMessage:"optionsSuccessPromptReloadRequired",PromptFailureMessage:"optionsFailurePrompt",AppearancePrefTitle:"appearancePrefTitle",AppearancePrefDesc:"appearancePrefDesc",AppearancePrefOp1:"appearancePrefOp1",AppearancePrefOp2:"appearancePrefOp2",AppearancePrefOp3:"appearancePrefOp3",SaveLocationTitle:"saveLocationPreferenceTitle",SaveLocationDescription:"saveLocationPreferenceDescription",SaveLocationOp1:"saveLocationOp1",SaveLocationOp2:"saveLocationOp2",SaveLocationOp3:"saveLocationOp3",userLocale:"userLocale",acrobatGsuiteTouchPointPreferenceTitle:"acrobatGsuiteTouchPointPreferenceTitle",acrobatGsuiteTouchPointPreferenceDescription:"acrobatGsuiteTouchPointPreferenceDescription",acrobatTouchPointPreferenceTitle:"acrobatTouchPointInOtherSitesPreferenceTitle",acrobatTouchPointPreferenceDescription:"acrobatTouchPointInOtherSitesPreferenceDescription",expressTouchpointPreferenceTitle:"expressTouchpointPreferenceTitle",expressTouchpointPreferenceDescription:"expressTouchpointPreferenceDescription",AIMarkerTouchpointPreferenceTitle:"aiMarkerTouchpointPreferenceTitle",AIMarkerTouchpointPreferenceDescription:"aiMarkerTouchpointPreferenceDescription",localFileOptionTitle:"localFileOptionTitle",localFileOptionDescription:"localFileOptionDesc",askAssistantBannerTitle:"askAssistantBannerTitle",askAssistantBannerContentText:"askAssistantBannerContentText"};let d=[],h={},u=null;class g{constructor(){this.showEligibleSaveButton(),this.ID="#web2pdfSaveButton",this.closePromptID="#prompt-close",this.enableState=!1,this.optionStates=new Set,this.timeoutId=null,this.reloadRequiredForPreference=!1,$(this.ID).click((e=>this.SavePreferences(e))),$(this.closePromptID).click((e=>this.HideSavedPrompt(e)))}showEligibleSaveButton(){let e,t;[e,t]=[$("#saveButtonHeader"),$("#saveButtonFooter")],e.removeClass("hidden"),t.remove()}Reset(){this.enableState=!1,this.optionStates.clear(),$(this.ID).prop("disabled",!0)}setEnabled(e){this.optionStates.add(e),$(this.ID).prop("disabled",!1),this.enableState=!0}setDisabled(e){this.optionStates.has(e)&&(this.optionStates.delete(e),0===this.optionStates.size&&($(this.ID).prop("disabled",!0),this.enableState=!1))}GetState(){return this.enableState}SavePreferences(){const e={analytics:[]};for(const t in h)h[t].hasUpdated&&(e[t]=h[t].GetCurrentState());const t=d.find((e=>"pdfViewer"===e.storageKey&&e.hasUpdated));if(t){let e;!0===t.currentState||"true"===t.currentState?(n.setItem("viewer-enabled-source","ownership-consent"),e="true"):e="false",s.isEdge()&&s.messageToMain({main_op:"pdfViewerChanged",value:e})}h.environment&&h.environment.hasUpdated&&(s.messageToMain({main_op:"init-floodgate"}),s.messageToMain({main_op:"closeOffscreenDocument"})),d.filter((e=>e.hasUpdated)).map((e=>e.SavePreferences())).filter((e=>e)).forEach((t=>e.analytics.push(t))),function(e,t){s.messageToMain({main_op:"save-preferences",...e},t)}(e,(e=>{e.success?this.ShowSavedPrompt(!0):this.ShowSavedPrompt(!1),this.Reset(),N((async e=>{D(e.settings),await L(e),w()}))}))}ShowSavedPrompt(e){const t=$("#savePrompt"),n=$(".prompt"),a=$("#optionsSuccessPrompt");e?(this.reloadRequiredForPreference?a.text(s.getTranslation(p.PromptSuccessReloadRequiredMessage)):a.text(s.getTranslation(p.PromptSuccessMessage)),this.reloadRequiredForPreference=!1,n.removeClass("failure")):(a.text(s.getTranslation(p.PromptFailureMessage)),n.addClass("failure")),t.show(),this.timeoutId&&clearTimeout(this.timeoutId),this.timeoutId=setTimeout((e=>this.HideSavedPrompt()),5e3)}HideSavedPrompt(){$("#savePrompt").hide()}}class T{constructor(e,t,s,a){this.titleId=e,this.descriptionId=t,this.storageKey=a,this.defaultState=n.getItem(this.storageKey)||s,this.currentState=this.defaultState,this.hasUpdated=!1,this.savePreferencesButton=null}AttachEventHandler(e){this.savePreferencesButton=e}RenderInputItem(){return $("<div/>")}Render(e=""){const t=$("<div/>",{class:"option "+e}),n=$("<label/>",{class:"label",for:this.titleId}),a=$("<span/>",{class:"label-title",text:s.getTranslation(this.titleId)||this.titleId,id:this.titleId}),i=$("<span/>",{class:"label-description",text:s.getTranslation(this.descriptionId)||this.descriptionId,id:this.descriptionId});n.append(a),n.append(i),t.append(n);const r=this.RenderInputItem();return t.append(r),t}GetCurrentState(){return this.currentState}SavePreferences(){this.hasUpdated&&(this.storageKey&&(s.consoleLog("Updating Preference for ",this.storageKey,"from",n.getItem(this.storageKey,this.defaultState),"to",this.currentState),"pdfViewer"===this.storageKey&&(n.getWithTTL("ownership-upgrade")&&!1===this.currentState&&(s.messageToMain({main_op:"analytics",analytics:[[t.USE_ACROBAT_VIEWER_DISABLED_DEFAULT_OWNERSHIP_EXPERIMENT,{SOURCE:"OptionsPage",EXPERIMENT:n.getItem("experiment-ownership")}],[t.USE_ACROBAT_VIEWER_DISABLED_DEFAULT_OWNERSHIP,{SOURCE:"OptionsPage"}]]}),n.removeItem("ownership-upgrade"),n.removeItem("defaultOwnerShipExperiment")),a.setViewerState(!0===this.currentState?"enabled":"disabled"),u.reloadRequiredForPreference=!0,this.publishDVStatusUpdate("gmail"),this.publishDVStatusUpdate("gdrive")),"acrobat-touch-points-in-other-surfaces"!==this.storageKey&&"acrobat-gsuite-touch-points"!==this.storageKey||(u.reloadRequiredForPreference=!0,this.sendAcrobatGsuiteTouchPointsAlert(this.currentState)),"express-touch-points"==this.storageKey&&(u.reloadRequiredForPreference=!0,chrome.runtime.sendMessage({main_op:"toggle-express-touch-points",allowed:this.currentState})),n.setItem(this.storageKey,String(this.currentState))),this.hasUpdated=!1,this.defaultState=this.currentState)}sendAcrobatGsuiteTouchPointsAlert(e){let t;t=e?"acrobatGsuiteTouchPointsEnabled":"acrobatGsuiteTouchPointsDisabled",chrome.tabs.query({url:["https://mail.google.com/*","https://drive.google.com/*"]},(function(e){e?.forEach((function(e){chrome.tabs.sendMessage(e.id,{content_op:t})}))}))}publishDVStatusUpdate=e=>{chrome.runtime?.sendMessage({main_op:"changeDefaultViewershipForSurface",surfaceId:e,isDefault:this.currentState,source:"extensionPreferencePage"})}}class m extends T{constructor(e,t,s,a,i,r){super(e,t,s,a),this.defaultState=function(e,t=!1){const s=n.getItem(e);return s&&""!==s?"true"===s:t}(this.storageKey,s),this.currentState=this.defaultState,this.analyticsId={enabled:i,disabled:r}}onToggleChange(e){const t=$(e.currentTarget);this.currentState=!t.hasClass("checked"),this.hasUpdated=!this.hasUpdated,t.toggleClass("checked"),this.savePreferencesButton&&this.currentState===this.defaultState?this.savePreferencesButton.setDisabled(this.titleId):this.savePreferencesButton.setEnabled(this.titleId)}RenderDisabledInputItem(){const e=$("<span/>"),t=$("<button/>",{class:"option-toggle-disabled"});return e.append(t),e}RenderInputItem(){const e=$("<span/>"),t=$("<button/>",{class:"option-toggle"});return t.click((e=>this.onToggleChange(e))),this.currentState&&t.addClass("checked"),e.append(t),e}GetAnalytics(){return this.currentState?this.analyticsId.enabled:this.analyticsId.disabled}SavePreferences(){return super.SavePreferences(),this.GetAnalytics()}}class S extends T{constructor(e,t,s,a,i,r,o){super(e,t,a,i),this.valuesMap=s,this.onSavePreferences=r,o&&!n.getItem(i)&&n.setItem(i,String(a))}onSelectionChange(e){this.currentState=$(e.currentTarget).val(),this.currentState===this.defaultState?(this.hasUpdated=!1,this.savePreferencesButton&&this.savePreferencesButton.setDisabled(this.titleId)):(this.hasUpdated=!0,this.savePreferencesButton&&this.savePreferencesButton.setEnabled(this.titleId))}RenderInputItem(){const e=$("<span/>"),t=$("<select/>",{class:"option-select"});for(const e in this.valuesMap){const n=$("<option/>",{value:e,text:this.valuesMap[e]});t.append(n)}return t.change((e=>this.onSelectionChange(e))),this.currentState&&t.val(this.currentState),e.append(t),e}SavePreferences(){const e=this.defaultState;super.SavePreferences(),this.onSavePreferences&&this.onSavePreferences(this.currentState,e)}}class f extends m{constructor(){let e="false"===n.getItem("ANALYTICS_OPT_IN_ADMIN")?p.AnalyticsOptinDisabledDescription:p.AnalyticsOptinDescription;super(p.AnalyticsOptinTitle,e,!0,"logAnalytics",t.OPTIONS_ENABLED_ANALYTICS,t.OPTIONS_DISABLED_ANALYTICS),this.learnMoreLink=p.AnalyticsLearnMoreLink,this.learnMoreTitle=p.AnalyticsLearnMoreTitle}Render(){const e=$("<div/>",{class:"option"}),a=$("<label/>",{class:"label",for:this.titleId}),i=$("<span/>",{class:"label-title",text:s.getTranslation(this.titleId),id:this.titleId}),r=$("<span/>",{class:"label-description",text:s.getTranslation(this.descriptionId)+" ",id:this.descriptionId}),o=$("<a/>",{class:"learn-more",href:s.getTranslation(this.learnMoreLink),text:s.getTranslation(this.learnMoreTitle),target:"_blank"});let c;return o.click((function(){s.messageToMain({main_op:"analytics",analytics:[[t.OPTIONS_ABOUT_ADOBE_ACROBAT_CLICKED]]})})),a.append(i),a.append(r),e.append(a),"false"===n.getItem("ANALYTICS_OPT_IN_ADMIN")?c=this.RenderDisabledInputItem():(c=this.RenderInputItem(),r.append(o)),e.append(c),e}SavePreferences(){if(this.hasUpdated)return this.hasUpdated=!1,this.defaultState=this.currentState,this.GetAnalytics()}}class I extends T{constructor(e,t,s){super(e,t,[],s),this.currentState=n.getItem(this.storageKey)||[]}RenderInputItem(){const e=$("<div/>",{class:"domain-container"}),t=this.renderTags(this.currentState);return $("<button/>",{id:"show-more-btn",text:"Show all"}).click((()=>{})),e.append(t),e}renderTags(e){const t=$("<div/>",{class:"tag-list",id:"tag-list"});for(let n of e){const e=$("<div/>",{class:"tag"});e.html(`${n} <span class="close-btn">×</span>`),t.append(e)}return t.on("click",".close-btn",(e=>{const t=e.currentTarget.parentElement,n=t.textContent.trim();this.removeDomain(n.slice(0,-2)),t.remove()})),t}Render(){if(this.currentState?.length)return super.Render("domain-option")}removeDomain(e){this.currentState=this.currentState.filter((t=>t!==e)),this.hasUpdated=!0,this.savePreferencesButton?.setEnabled(this.titleId)}SavePreferences(){this.hasUpdated&&(this.storageKey&&(s.consoleLog("Updating domains for",this.storageKey,"to",this.currentState),n.setItem(this.storageKey,this.currentState)),this.hasUpdated=!1,this.defaultState=this.currentState)}}class P extends T{constructor(e,t){super(e,t,null,null)}onButtonClick(n){chrome.tabs.create({url:r,active:!0}),chrome.extension.isAllowedFileSchemeAccess().then((n=>{e.event(t.LOCAL_FILE_OPTIONS_CLICKED,{STATE:n?"Disable":"Enable"})}))}RenderInputItem(){const e=$("<span/>"),t=$("<button/>",{class:"option-localfile"}),n=$("<span/>",{class:"option-localfile-text"});return chrome.extension.isAllowedFileSchemeAccess().then((e=>{n.text(s.getTranslation(e?"Disable":"Enable")),t.append(n),t.append($("<img>",{class:"option-localfile-icon"}).attr("src","../images/SDC_LinkOut_13_N.svg"))})),t.click((e=>this.onButtonClick(e))),e.append(t),e}SavePreferences(){}}class E extends T{constructor(e,t){super(e,t,null,null)}handleClick(){s.messageToMain({main_op:"analytics",analytics:[t.TREFOIL_HTML_PREFERENCES_CLICK]}),s.messageToMain({main_op:"showConversionSettingsDialog"})}RenderInputItem(){const e=$("<span/>"),t=$("<button/>",{class:"option-webpage-conversion"}),n=$("<span/>",{class:"option-webpage-conversion-text"});return n.text(s.getTranslation("editMegaVerbText")),t.append(n),t.click(this.handleClick),e.append(t),e}}class _ extends T{constructor(e,t,n,s){super(e),this.optionClassOverride=s,this.contentTextId=t,this.contentImagePath=n}Render(){const e=$("<div/>",{class:"option "+this.optionClassOverride}),t=$("<label/>",{class:"label",for:this.titleId}),n=$("<span/>",{class:"label-title",id:this.titleId});n.append(document.createTextNode(s.getTranslation(this.titleId)||this.titleId),$("<span/>",{text:"Beta",class:"beta-label"}));const a=$("<span/>",{class:"label-description",text:s.getTranslation(this.descriptionId)||this.descriptionId,id:this.descriptionId}),i=$("<div/>",{class:"preference-item-banner-content-wrapper"}),r=$("<div/>",{class:"banner-content-text-wrapper"}),o=$("<span/>",{class:"banner-content-text",text:s.getTranslation(this.contentTextId)||this.contentTextId});if(r.append(o),i.append(r),this.contentImagePath){const e=$("<div/>",{class:"banner-content-image-wrapper"}),t=$("<img>",{class:"banner-content-image"}).attr("src",this.contentImagePath);e.append(t),i.append(e)}return t.append(n),t.append(a),e.append(t),e.append(i),e}}class O extends T{constructor(e,t){super(),this.optionClassOverride=e,this.contentImagePath=t}Render(){return $("<div/>",{class:`option ${this.optionClassOverride}`}).append($("<img>",{class:"banner-image",src:this.contentImagePath,id:"aiMarkerTouchpointBanner"}))}}function v(e){return e.version>13}function b(e){return 13==e.version}function A(){const e=n.getItem("fteDenied")||"0",t="false"===n.getItem("pdfViewer");return SETTINGS.VIEWER_SHOW_OPEN_IN_ACRO&&(parseInt(e)===l||t)}function D(e){if(e&&e.settings){for(const t in e.settings)SETTINGS[t]=e.settings[t];(function(e){return null===e.locale})(e)&&(SETTINGS.FRICTIONLESS_ENABLED=!1)}}function w(){null==u&&(u=new g);const e=$("#toggles");$("#progress").remove(),e.empty(),d.forEach((t=>{t.AttachEventHandler(u);const n=t.Render();e.append(n)}))}async function L(e){d=[],h={};const r=new f,o=new m(p.ShowPDFToolsTitle,p.ShowPDFToolsDescription,!0,"always-show-pdftools",t.FRICTIONLESS_AUTO_SUGGESTION_ENABLED,t.FRICTIONLESS_AUTO_SUGGESTION_DISABLED),l=new m(p.AIMarkerTouchpointPreferenceTitle,p.AIMarkerTouchpointPreferenceDescription,!0,"aiMarkers",t.OPTIONS_ENABLE_AI_MARKERS,t.OPTIONS_DISABLE_AI_MARKERS),u=new m(p.ViewerOwnershipTitle,p.ViewerOwnershipDescription,!1,"pdfViewer",t.USE_ACROBAT_IN_CHROME_ENABLED,t.USE_ACROBAT_IN_CHROME_DISABLED),g=new m(p.ViewConvertedPDFInAcrobatTitle,p.ViewConvertedPDFInAcrobatDescription,!0,"ViewResultsPref",t.TREFOIL_HTML_OPENPDF_PREF_ON,t.TREFOIL_HTML_OPENPDF_PREF_OFF),D=new m(p.PersistentOpenInAcrobatTitle,p.PersistentOpenInAcrobatDescription,!0,"always-show-pdf-menu",t.OPTIONS_ENABLED_OPEN_IN_ACROBAT,t.OPTIONS_DISABLED_OPEN_IN_ACROBAT),w=new m(p.EnableGenAIFeaturesTitle,p.EnableGenAIFeaturesDescription,!0,"egaf",t.OPTIONS_ENABLE_GENAI_FEATURES,t.OPTIONS_DISABLE_GENAI_FEATURES),L=new P(p.localFileOptionTitle,p.localFileOptionDescription),N=new E(p.WebpageConversionTitle,p.WebpageConversionDescription);v(e)?(d.push(g),SETTINGS.VIEWER_ENABLED&&SETTINGS.VIEWER_ENABLED_FOR_ACROBAT?(d.push(u),A()&&d.push(D)):d.push(D)):b(e)?await async function(){const e=await async function(){return!(s.isEdge()&&await a.isMimeHandlerAvailable()&&n.getItem("openInAcrobatEnable")&&"admin"!==n.getItem("installSource"))}();SETTINGS.VIEWER_ENABLED?(d.push(u),A()&&e&&d.push(D)):e&&d.push(D)}():SETTINGS.VIEWER_ENABLED&&d.push(u);const C=[chrome.runtime.sendMessage({main_op:"getFloodgateFlag",flag:"dc-cv-gmail-attachment-card-prompt"}),chrome.runtime.sendMessage({main_op:"getFloodgateFlag",flag:"dc-cv-gmail-list-view-prompt"}),chrome.runtime.sendMessage({main_op:"getFloodgateFlag",flag:"dc-cv-gdrive-prompt"}),chrome.runtime.sendMessage({main_op:"getFloodgateFlag",flag:"dc-cv-embedded-pdf-touch-point"})],[R,F,B,M]=await Promise.all(C);if(R||F||B||M){let ne;const se=n.getItem("locale");ne="en-US"===se||"en-GB"===se?new m(p.acrobatTouchPointPreferenceTitle,p.acrobatTouchPointPreferenceDescription,!0,"acrobat-touch-points-in-other-surfaces",t.OPTIONS_ACROBAT_TOUCH_POINT_ENABLED,t.OPTIONS_ACROBAT_TOUCH_POINT_DISABLED):new m(p.acrobatGsuiteTouchPointPreferenceTitle,p.acrobatGsuiteTouchPointPreferenceDescription,!0,"acrobat-touch-points-in-other-surfaces",t.OPTIONS_ACROBAT_TOUCH_POINT_ENABLED,t.OPTIONS_ACROBAT_TOUCH_POINT_DISABLED),d.push(ne)}const x=await chrome.runtime.sendMessage({main_op:"getFloodgateFlag",flag:"dc-cv-genai-disable-pref"}),y="true"===n.getItem("genAIEligible");y&&x&&d.push(w),SETTINGS.FRICTIONLESS_ENABLED&&d.push(o);const G=await chrome.runtime.sendMessage({main_op:"getFloodgateFlag",flag:"dc-cv-local-file-fte"}),k=await chrome.extension.isAllowedFileSchemeAccess();!G||s.isEdge()||k||d.push(L);const U=s.getTranslation(p.AppearancePrefOp1),V=s.getTranslation(p.AppearancePrefOp2),H=s.getTranslation(p.AppearancePrefOp3);const K=new S(p.AppearancePrefTitle,p.AppearancePrefDesc,{auto:U,dark:V,light:H},"auto","theme",(function(e,n){s.messageToMain({main_op:"themeChange",analytics:[[t.OPTIONS_APPEARENCE_THEME_CHANGED,{OLDTHEME:n,NEWTHEME:e}]]})}),!0);if(d.push(K),!0===n.getItem("isSaveLocationPrefEnabled")){const ae=s.getTranslation(p.SaveLocationOp1),ie=s.getTranslation(p.SaveLocationOp2),re=s.getTranslation(p.SaveLocationOp3);function oe(e,a){s.messageToMain({main_op:"analytics",analytics:[[t.SAVE_LOCATION_PREFERENCE_CHANGED,{OLDPREF:a,NEWPREF:e}]]}),n.setItem("selectedSaveLocationPreference",!0)}const ce=new S(p.SaveLocationTitle,p.SaveLocationDescription,{ask:ae,cloud:ie,local:re},"ask","saveLocation",oe,!0);d.push(ce)}const W=new S(p.userLocale,null,i,n.getItem("viewer-locale")||s.getFrictionlessLocale(chrome.i18n.getMessage("@@ui_locale")),"appLocale",(async()=>{}),!0);d.push(W);const q=[chrome.runtime.sendMessage({main_op:"express-init"}),chrome.runtime.sendMessage({main_op:"whatsapp-express-init"}),chrome.runtime.sendMessage({main_op:"gmail-express-init"}),chrome.runtime.sendMessage({main_op:"google-image-preview-express-init"})],[j,X,Y,z]=await Promise.all(q);if(j.shouldEnableExpressTouchpointsPreference||X.enableExpressOptionsPagePreference||Y.enableExpressOptionsPagePreference||z.enableExpressOptionsPagePreference){const le=new m(p.expressTouchpointPreferenceTitle,p.expressTouchpointPreferenceDescription,!0,"express-touch-points",t.OPTIONS_EXPRESS_TOUCHPOINT_ENABLED,t.OPTIONS_EXPRESS_TOUCHPOINT_DISABLED);d.push(le)}d.push(r),h.analytics_on=r,function(e){function t(e){s.messageToMain({panel_op:"common",requestType:"update_env",env:e})}const a=new S("Development Environment","Select the target environment for the extension.",{prod:"Production",stage:"Stage",test:"Test",dev:"Dev","local-dev":"Local Dev"},e.environment||"prod","env",t),i=new S("GenAI Cluster","Select the target cluster for the extension.",{develop:"Develop",beta:"Beta",release:"Release"},c(),"cluster"),r=new S("Development Environment","Select the target environment for the extension.",{prod:"Production",stage:"Stage"},e.environment||"prod","env",t),o=v(e)?"acrobat":b(e)?"reader":"no-app",l=new S("Connected Application","Select the target connected application for the extension functionalities. This settings only mock the views, the functionality may be broken.",{acrobat:"Acrobat",reader:"Reader","no-app":"No App"},o||"acrobat"),p="true"===n.getItem("adobeInternal");SETTINGS.DEBUG_MODE?(d.push(a,i,l),h.environment=a,h.product=l):p&&(d.push(r),h.environment=r)}(e),v(e)&&d.push(N);const J=new _(p.askAssistantBannerTitle,p.askAssistantBannerContentText,"../images/ai_assistant_web_page.svg","ai-assistant-banner-header-wrapper"),Q=new m("genAIFabPreferenceTitle","genAIFabPreferenceDescription",!1,"enableGenAIFab",t.OPTIONS_ENABLE_GEN_AI_FAB,t.OPTIONS_DISABLE_GEN_AI_FAB),Z=(new class extends T{constructor(e,t,n,a){super(e,t,null,null),this.url=n,this.buttonText=s.getTranslation(a)}onButtonClick(e){chrome.tabs.create({url:this.url,active:!0})}RenderInputItem(){const e=$("<span/>"),t=$("<button/>",{class:"option-localfile"}),n=$("<span/>",{class:"option-localfile-text"});return n.text(this.buttonText),t.append(n),t.append($("<img>",{class:"option-localfile-icon"}).attr("src","../images/SDC_LinkOut_13_N.svg")),t.click((e=>this.onButtonClick(e))),e.append(t),e}SavePreferences(){}}("sidepanelLocationPreferenceTitle","sidepanelLocationPreferenceDescription","chrome://settings/appearance#:~:text=Side%20panel%20position","sidepanelLocationPreferenceButtonText"),new I("domainPreferenceTitle","","hideFabDomainList"));n.getItem("sidePanelRegistered")&&(d.push(J),d.push(Q),d.push(Z));const ee=new O("ai-assistant-banner-header-wrapper","../images/SummarizeBanner.svg"),te=await chrome.runtime.sendMessage({main_op:"getFloodgateFlag",flag:"dc-cv-genai-markers-internal"});y&&x&&te&&(d.push(ee),d.push(l))}function N(e){s.messageToMain({main_op:"fetch-preferences"},e)}function C(e){const t=d.filter((t=>t.titleId===e));return t.length>0?t[0]:null}function R(e,t,n){if(SETTINGS.TEST_MODE)return;const s=e.toggleId,a=C(s),i=e.requestType;let r,c;switch(i){case o.OPTIONS_UPDATE_TOGGLE:a?(a.currentState=e.toggleVal,a.savePreferencesButton.SavePreferences(),r=a.currentState):c="Toggle not visible.",n&&n({requestType:i,toggleId:s,response:r,error:c});case o.OPTIONS_HIGHLIGHT_SECTION:e.sectionIds&&(!function(e){const t=[],n=()=>{t.forEach((e=>{e.removeClass("highlighted-section"),e.off("mouseenter.highlightGroup")}))};e.forEach((e=>{if(!e)return;const s=$(`#${e}`).closest(".option");s.length>0&&(s.addClass("highlighted-section"),t.push(s),s.off("mouseenter.highlightGroup").on("mouseenter.highlightGroup",n))})),t.length>0&&t[0][0].scrollIntoView({behavior:"smooth",block:"center"})}(e.sectionIds),n&&n({success:!0}))}}$(document).ready((function(){s.translateElements(".translate"),N((async e=>{D(e),await L(e),w(),s.addMainListener(R),function(){if(!SETTINGS.TEST_MODE)return;const e="check_toggle_state",t="update_toggle_state";chrome.runtime.onMessage.addListener((function(n,s,a){if(!n.panel_op||"test"!==n.panel_op)return;const i=n.test_extension,r=n.toggleId,o=C(r);let c,l;switch(i){case e:o?c=o.currentState:l="Toggle not visible.";break;case t:o?(o.currentState=n.toggleVal,o.hasUpdated=!0,o.savePreferencesButton.SavePreferences(),c=o.currentState):l="Toggle not visible.";break;default:l="Invalid request type."}a({requestType:i,toggleId:r,response:c,error:l})}))}();await a.isMimeHandlerAvailable()||chrome.runtime.sendMessage({main_op:"updateLoadedTabsInfo"})}))}))}));