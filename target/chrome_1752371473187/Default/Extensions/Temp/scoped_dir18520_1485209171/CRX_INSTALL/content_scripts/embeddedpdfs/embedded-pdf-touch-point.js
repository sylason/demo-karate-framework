/*************************************************************************
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2015 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by all applicable intellectual property laws,
* including trade secret and or copyright laws.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
const sendAnalytics=(e,t)=>{try{t={...t,domain:domain},chrome.runtime.sendMessage({main_op:"analytics",analytics:[[e,t]]})}catch(e){}};let domain="";if(window.self!==window.top){const e={},t="acrobat-embedded-pdf-touch-point-context-menu",n=(e,n)=>{const o=e.getElementsByClassName(t)&&e.getElementsByClassName(t)[0];o&&o.remove(),n.style.removeProperty("background"),n.setAttribute("src",chrome.runtime.getURL("browser/images/SDC_ShowMenu_18_N_24_D.svg"))},o=e=>{const t=document.createElement("div");return t.setAttribute("class","acrobat-embedded-pdf-touch-point-tooltip"),t.innerText=e?.touchPointText||"Open in Acrobat",t},d=()=>{const e=document.createElement("img");return e.setAttribute("src",chrome.runtime.getURL("browser/images/acrobat_dc_trefoil_24_white.svg")),e.classList.add("acrobat-embedded-pdf-icon"),e.setAttribute("tabindex","1"),e},s=()=>{const e=document.createElement("img");return e.setAttribute("src",chrome.runtime.getURL("browser/images/SDC_ShowMenu_18_N_24_D.svg")),e.classList.add("acrobat-embedded-pdf-touch-point-hamburger-menu"),e},i=()=>{document.getElementsByClassName("acrobat-fte-tooltip-container")?.length>0&&document.getElementsByClassName("acrobat-fte-tooltip-container")[0]?.remove()},a=(e,t)=>{if("Enter"===e.key||"click"===e.type){sendAnalytics("DCBrowserExt:EmbeddedPDF:TouchPoint:Clicked"),chrome.storage.local.set({embeddedPDFTouchPointFTEState:{touchPointClicked:!0}});const e=new URL(t);e.searchParams.set("acrobatPromotionSource","embeddedPDF"),window.open(e.toString()),i()}},c=e=>{const t=document.createElement("div");return t.textContent=e?.menuItemStrings?.hideIconForNow,t.classList.add("acrobat-embedded-pdf-touch-point-context-menu-item"),t.addEventListener("click",(()=>{document.getElementsByClassName("acrobat-embedded-pdf-touch-point")?.length>0&&document.getElementsByClassName("acrobat-embedded-pdf-touch-point")[0].remove(),sendAnalytics("DCBrowserExt:EmbeddedPDF:HideNow:Clicked")})),t},r=()=>{const e=document.createElement("hr");return e.classList.add("acrobat-embedded-pdf-touch-point-context-menu-item-separator"),e},m=e=>{const t=document.createElement("div");return t.textContent=e?.menuItemStrings?.openPDFInAcrobat,t.classList.add("acrobat-embedded-pdf-touch-point-context-menu-item"),t.addEventListener("click",(e=>{a(e,window.location.href),sendAnalytics("DCBrowserExt:EmbeddedPDF:OpenInAcrobat:Clicked")})),t},l=(n,o,d)=>{const s=n.getElementsByClassName(t)&&n.getElementsByClassName(t)[0];if(e.menuClick=!e.menuClick,s)o.style.removeProperty("background"),o.setAttribute("src",chrome.runtime.getURL("browser/images/SDC_ShowMenu_18_N_24_D.svg")),sendAnalytics("DCBrowserExt:EmbeddedPDF:Menu:Closed"),s.remove();else{o.setAttribute("src",chrome.runtime.getURL("browser/images/SDC_ShowMenu_18_N_24_D_ActiveState.svg")),o.style.background="rgba(37, 37, 37, 1)",sendAnalytics("DCBrowserExt:EmbeddedPDF:Menu:Clicked");const s=document.createElement("div");s.classList.add(t);const i=c(d),a=m(d),l=r();s.appendChild(a),s.appendChild(l),s.appendChild(i),s.addEventListener("mouseleave",(()=>{e.menuItemHovered=!1})),s.addEventListener("mouseenter",(()=>{e.menuItemHovered=!0})),n.appendChild(s)}},u=t=>{const i=document.createElement("button");i.classList.add("acrobat-embedded-pdf-touch-point");const c=s(),r=document.createElement("div");r.classList.add("acrobat-embedded-pdf-touch-point-hamburger-menu-container"),r.appendChild(c);const m=d();return m.addEventListener("click",(e=>a(e,window.location.href))),m.addEventListener("keydown",(e=>a(e,window.location.href))),c.addEventListener("click",(()=>l(r,c,t))),i.appendChild(r),i.appendChild(m),i.appendChild(o(t)),i.addEventListener("mouseenter",(()=>{e.menuClick||(n(r,c),0===document.getElementsByClassName("acrobat-fte-tooltip-container")?.length&&(document.getElementsByClassName("acrobat-embedded-pdf-touch-point-hamburger-menu-container")[0].style.display="flex"))})),i.addEventListener("mouseleave",(()=>{setTimeout((()=>{e.menuClick&&e.menuItemHovered||(e.menuClick=!1,e.menuItemHovered=!1,document.getElementsByClassName("acrobat-embedded-pdf-touch-point-hamburger-menu-container")[0].style.display="none")}),400)})),i},p=async e=>{if(e?.enableEmbeddedPDFTouchPoint){const t=u(e);document.documentElement.appendChild(t),sendAnalytics("DCBrowserExt:EmbeddedPDF:TouchPoint:Shown");const n=t?.getBoundingClientRect(),o=window?.frameElement?.getBoundingClientRect();chrome.runtime.sendMessage({main_op:"embedded-pdf-touch-point-added",frameId:e?.frameId,position:{top:n.top+o?.top,left:n.left+o?.left,right:n.right,bottom:n.bottom}})}},b=async()=>{const e=await import(chrome.runtime.getURL("content_scripts/gsuite/fte-utils.js")),t=await chrome.runtime.sendMessage({main_op:"embedded-pdf-touch-point-config"}),n=document.getElementsByClassName("acrobat-embedded-pdf-touch-point"),o=document.getElementsByClassName("acrobat-fte-tooltip");if(n?.length>0&&0===o?.length){const o=e.createFteTooltip(t?.fteToolTipStrings,"embeddedPDF");n[0].appendChild(o),sendAnalytics("DCBrowserExt:EmbeddedPDF:FTE:Shown");o.querySelector(".acrobat-fte-tooltip-button").addEventListener("click",(()=>{o?.remove(),sendAnalytics("DCBrowserExt:EmbeddedPDF:FTE:Closed")})),e?.updateFteToolTipCoolDown(t?.touchPointConfig?.tooltip,"embeddedPDFTouchPointFTEState"),o.addEventListener("mouseenter",(e=>{e.stopPropagation(),e.preventDefault()}),{capture:!0})}},h=async()=>{const e=await chrome.runtime.sendMessage({main_op:"embedded-pdf-touch-point-config"});e?.touchPointConfig?.blockedDomains?.includes(domain)||(e?.enableEmbeddedPDFTouchPoint&&sendAnalytics("DCBrowserExt:EmbeddedPDFs:TouchPoint:Enabled"),window.innerHeight<250||window.innerWidth<201?sendAnalytics("DCBrowserExt:EmbeddedPDF:TopNavNotPresent:WidthHeight"):p(e))};if(chrome.runtime.onMessage.addListener((e=>{"add-fte-for-embedded-pdf-touch-point"===e?.type&&b()})),document?.contentType?.includes("application/pdf")){const e=new URL(window.location.href),t=e?.hash?.includes("toolbar=0");domain=e.hostname;let n="Unknown";document.body?.childNodes?.length>0&&document.body.childNodes[0]?.getAttribute?.("src")?.startsWith("chrome-extension://dahenjhkoodjbpjheillcadbppiidmhp")?n="GoogleScholar":document.body?.childNodes?.length>0&&"about:blank"===document.body.childNodes[0]?.getAttribute?.("src")&&(n="NativeViewer"),sendAnalytics("DCBrowserExt:Viewer:Detected:EmbededPDF:IframeContentType",{eventContext:`${n}-${!t}`}),h()}}